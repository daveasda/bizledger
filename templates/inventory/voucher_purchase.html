{% extends "inventory/base_inventory.html" %}
{% block inventory_content %}
<div class="bg-white border rounded p-6 max-w-4xl mx-auto">
  <h1 class="text-2xl font-bold mb-4">Purchase (with Items)</h1>
  {% if form.non_field_errors or form.errors %}
  <div class="mb-4 p-3 rounded border border-red-400 bg-red-50 text-red-800 text-sm">
    {{ form.non_field_errors }}
    {% for field in form %}{% if field.errors %}<div>{{ field.label }}: {{ field.errors }}</div>{% endif %}{% endfor %}
  </div>
  {% endif %}
  <form method="post" action="" class="space-y-4">
    {% csrf_token %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Party A/c (Supplier)</label>
        {{ form.party }}
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Purchase Ledger</label>
        {{ form.purchase_ledger }}
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Godown</label>
        {{ form.godown }}
      </div>
      <div>
        <label class="block text-sm font-semibold text-gray-800 mb-1">Posting date</label>
        {{ form.posting_date }}
      </div>
    </div>
    <div>
      <label class="block text-sm font-semibold text-gray-800 mb-1">Narration</label>
      {{ form.narration }}
    </div>

    <div class="border rounded p-4 bg-slate-50">
      <h3 class="font-semibold mb-3">Item table</h3>
      <table class="w-full text-sm">
        <thead>
          <tr class="border-b">
            <th class="text-left py-2 px-2">Item</th>
            <th class="text-left py-2 px-2">Qty</th>
            <th class="text-left py-2 px-2">Rate</th>
            <th class="text-left py-2 px-2">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for f in row_formset %}
          <tr>
            <td class="py-1 px-2">{{ f.item }}</td>
            <td class="py-1 px-2">{{ f.qty }}</td>
            <td class="py-1 px-2">{{ f.rate }}</td>
            <td class="py-1 px-2 text-slate-500">(auto)</td>
          </tr>
          {% if f.errors %}<tr><td colspan="4" class="text-red-600 text-xs">{{ f.errors }}</td></tr>{% endif %}
          {% endfor %}
        </tbody>
      </table>
      {{ row_formset.management_form }}
    </div>

    <div class="flex gap-2 pt-4">
      <button type="submit" class="px-6 py-2 bg-slate-700 text-white rounded hover:bg-slate-800 font-semibold">Post</button>
      <a href="{% url 'inventory:stock_summary' %}" class="px-6 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 font-semibold">Cancel</a>
    </div>
  </form>
  <p class="mt-4"><a href="{% url 'inventory:gateway' %}" class="text-slate-600 hover:underline">‚Üê Gateway</a></p>
</div>
{% endblock %}
